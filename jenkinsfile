pipeline {
	    agent any
	    
	        environment {
         registry = "rahmachaabane/projetdevops-backend"
        registryCredential = 'dockerHub'
        dockerImage = ''
    }
	    stages{
	        stage('Clone'){
	             steps{  
	                 git branch: 'rahma', url: 'https://github.com/chouichi-houda/devopsback.git'
	             }
	        }  
	       stage('MVN CLEAN') {
	            steps {
	                sh 'mvn clean'
	                 
	            }
	        }
	        stage('MVN COMPILE') {
	            steps {
	                   sh 'mvn compile -e'
	                 
	            }
	        }
		stage('Unit tests') {
                    steps {
                           sh 'mvn test'
                    }
		}
		stage('MVN SONARQUBE') {
            steps {
                sh 'mvn sonar:sonar -Dsonar.login=admin -Dsonar.password=sonar'
                 
            }
        }
        
        
	   
		
	      stage("Build the package"){
                            steps {
                                sh 'docker-compose up -d --build'
                            }
                        }


        stage('Building image') {
            steps {
                script {
                    dockerImage = docker.build registry + ":$BUILD_NUMBER"
                }
            }
        }

         stage("nexus deploy"){
              steps{
                       sh 'mvn  deploy'
                      }
                 }
/*
        stage('Deploy image') {
            steps {
                script {
                    docker.withRegistry( '', registryCredential ) {
                        dockerImage.push()
                    }
                }
            }
        }
        */

    }
}
       
		
	    }
	}

